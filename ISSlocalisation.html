<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/ISSloc.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lokalizacja ISS</title>

</head>

<body>
<nav class="menu">
    <ul class="top-nav">
        <li><a class="active" href="index.html">Strona Główna</a></li>
        <li><a href="ISSlocalisation.html">Lokalizacja ISS</a></li>
        <li><a href="CatFacts.html">Ciekawostki o kotach</a></li>
        <li><a href="FantasyBooks.html">Może trochę fantasy?</a></li>
        <li class="right"><a class="active" href="AboutMe.html">O mnie</a></li>
    </ul>
</nav>

<div id="map"><p>Proszę czekać, heroku się rozpędza</p></div>

<div style="min-height: calc(20% - 50px);"></div>

<footer class="footer">
    Copyright 2021 by Dawid Kiełkowski
</footer>
</body>
<script>

    async function initMap() {

        async function getData() {
            return await fetch("https://iss-boot.herokuapp.com/iss")
                .then(r => r.json());
        }

        var data = await getData();

        var lat = parseFloat(data.iss_position.latitude);
        var lng = parseFloat(data.iss_position.longitude);

        var options = {
            zoom: 8,
            center: {
                lat: lat,
                lng: lng
            }
        }

        let loc = document.getElementById("map");

        map = new google.maps.Map(loc, options);

        var marker = new google.maps.Marker({
            position: {
                lat: lat,
                lng: lng
            },
            map: map,
            icon: 'Resources/rsz_station.png'
        });

        while (true) {
            data = await getData();
            lat = parseFloat(data.iss_position.latitude);
            lng = parseFloat(data.iss_position.longitude);
            marker.setPosition(new google.maps.LatLng(lat, lng))
            map.panTo(new google.maps.LatLng(lat, lng))
        }
    }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVYF9hrVgfZa9nYNBgrj6I8FnI8hYJhCg&callback=initMap&libraries=&v=weekly"></script>

</html>